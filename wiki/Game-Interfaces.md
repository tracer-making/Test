# 游戏界面系统

"溯洄遗梦"采用状态机架构，包含丰富多样的游戏界面，每个界面都有其独特的功能和交互方式。

## 系统概述

游戏通过状态模式管理所有界面，每个界面都是一个独立的状态类，继承自[State](../Tracer/src/core/State.h)基类。这种设计使得界面切换清晰、易于维护，并支持复杂的交互逻辑。

## 主要界面详解

### 1. 主菜单界面 (MainMenuState)

[MainMenuState](../Tracer/src/states/MainMenuState.h)是游戏的起始界面，为玩家提供进入游戏的入口。

#### 核心功能
- **开始游戏**：进入地图探索界面
- **视觉效果**：科技感数据流、装饰性花纹、闪烁星光
- **上帝模式**：开发者测试功能

#### 界面组成
- 标题展示区域
- 功能按钮区域（开始游戏、设置等）
- 背景装饰元素
- 数据流动画效果

#### 技术实现
- 使用SDL_ttf渲染字体
- 实现粒子效果（数据流、星光）
- 响应式按钮交互

### 2. 地图探索界面 (MapExploreState)

[MapExploreState](../Tracer/src/states/MapExploreState.h)是游戏的核心导航界面，玩家在此选择前进路径。

#### 核心功能
- **分层地图展示**：10层结构，每层3个节点
- **节点类型区分**：起点、普通、Boss、精英、商店、事件
- **路径选择**：玩家移动和路径规划
- **滚动机制**：支持垂直滚动查看完整地图

#### 界面组成
- 分层节点展示
- 连接线路绘制
- 玩家位置标记
- 节点状态标识（已访问、可访问）
- 滚动控制区域

#### 节点类型
1. **起点节点**：游戏起始位置
2. **普通节点**：常规战斗或事件
3. **Boss节点**：Boss战挑战
4. **精英节点**：强力敌人战斗
5. **商店节点**：进入墨坊商店
6. **事件节点**：特殊事件或奖励

#### 技术实现
- 复杂的地图生成算法
- 路径验证和可达性计算
- 玩家移动动画系统
- 滚动边界控制

### 3. 战斗界面 (BattleState)

[BattleState](../Tracer/src/states/BattleState.h)是游戏最复杂的界面，包含完整的回合制战斗系统。

#### 核心功能
- **3x4战场网格**：结构化战斗区域
- **回合制战斗**：玩家回合与敌人回合交替
- **印记系统**：丰富的卡牌特殊能力
- **Boss战机制**：多阶段Boss设计
- **道具系统**：战斗中使用道具
- **墨尺平衡**：攻击平衡指示器

#### 界面组成
- 战场区域（3行4列网格）
- 手牌区域
- 敌人信息区域
- 墨尺显示
- 道具槽位
- 生命值显示
- 状态信息面板

#### 战斗机制
1. **卡牌放置**：将手牌放置到战场
2. **攻击系统**：多种攻击类型（普通、双向、三向等）
3. **移动系统**：卡牌在战场上的移动
4. **献祭系统**：献祭卡牌获得资源
5. **成长系统**：卡牌属性随回合增长

#### 技术实现
- 复杂的动画系统（攻击、移动、特效）
- 印记效果处理
- 墨尺平衡计算
- Boss阶段转换逻辑

### 4. 墨坊商店界面 (InkShopState)

[InkShopState](../Tracer/src/states/InkShopState.h)是玩家购买墨的商店界面。

#### 核心功能
- **墨品展示**：各种墨的属性和价格
- **文脉支付**：使用文脉购买墨
- **入口赠礼**：首次进入赠送基础墨

#### 界面组成
- 商店标题
- 墨品展示区域
- 文脉余额显示
- 返回按钮
- 状态提示信息

#### 技术实现
- 商品布局和渲染
- 购买逻辑处理
- 资源管理

### 5. 墨工坊界面 (InkWorkshopState)

[InkWorkshopState](../Tracer/src/states/InkWorkshopState.h)允许玩家使用毛皮换取卡牌或道具。

#### 核心功能
- **毛皮消耗**：不同毛皮对应不同消耗
- **卡牌获取**：换取各种类型的卡牌
- **道具系统**：获取战斗道具

#### 界面组成
- 工坊标题
- 毛皮槽位
- 可获得物品展示
- 道具槽位
- 消耗提示

#### 技术实现
- 毛皮类型识别
- 物品生成算法
- 道具管理系统

### 6. 合卷界面 (CombineState)

[CombineState](../Tracer/src/states/CombineState.h)允许玩家将两张相同卡牌合成为更强的卡牌。

#### 核心功能
- **卡牌检索**：查找牌库中相同的卡牌
- **合成功能**：将两张卡牌合成为一张
- **动画效果**：合成过程的视觉反馈

#### 界面组成
- 合成槽位（上方两个并排大牌位）
- 选择界面（下方同名卡牌组）
- 合成按钮
- 返回按钮

#### 技术实现
- 卡牌匹配算法
- 合成规则处理
- 动画系统

### 7. 牌组查看界面 (DeckState)

[DeckState](../Tracer/src/states/DeckState.h)用于查看玩家当前的完整牌组。

#### 核心功能
- **牌组展示**：显示所有拥有的卡牌
- **属性查看**：查看卡牌详细属性
- **统计信息**：牌组构成分析

#### 界面组成
- 牌组标题
- 卡牌网格展示
- 背景装饰
- 返回按钮

#### 技术实现
- 网格布局算法
- 卡牌渲染
- 数据统计

### 8. 记忆修复界面 (MemoryRepairState)

[MemoryRepairState](../Tracer/src/states/MemoryRepairState.h)提供卡牌选择机制。

#### 核心功能
- **三选一机制**：从候选卡牌中选择
- **提示系统**：根据地图节点提供提示
- **Boss奖励**：Boss战胜利后的特殊奖励

#### 界面组成
- 候选卡牌展示
- 提示信息
- 选择反馈
- 重新抽卡功能

#### 技术实现
- 卡牌生成算法
- 提示类型处理
- 选择逻辑

### 9. 墨宝拾遗界面 (RelicPickupState)

[RelicPickupState](../Tracer/src/states/RelicPickupState.h)是道具收集界面。

#### 核心功能
- **道具补齐**：当道具不足三个时随机补齐
- **拾取机制**：选择拾取的道具
- **替代机制**：可选择生成卡牌替代道具

#### 界面组成
- 道具候选展示
- 拾取按钮
- 替代选项
- 动画效果

#### 技术实现
- 随机生成算法
- 道具管理
- 拾取动画

### 10. 以物易物界面 (BarterState)

[BarterState](../Tracer/src/states/BarterState.h)允许玩家使用毛皮交换其他卡牌。

#### 核心功能
- **毛皮交易**：不同毛皮对应不同交易
- **卡牌交换**：换取随机卡牌
- **交易类型**：兔皮、狼皮、金羊皮三种交易

#### 界面组成
- 玩家毛皮展示
- 交易卡牌展示
- 交易类型选择
- 交易按钮

#### 技术实现
- 毛皮检测
- 交易逻辑
- 卡牌生成

### 11. 意境刻画界面 (EngraveState)

[EngraveState](../Tracer/src/states/EngraveState.h)用于收集和组合意与境。

#### 核心功能
- **三选一收集**：收集意（印记）和境（部类）
- **组合机制**：将意与境进行绑定
- **自动应用**：符合条件的卡牌自动获得印记

#### 界面组成
- 选择区域（三个随机选项）
- 已收集展示
- 组合界面
- 反馈信息

#### 技术实现
- 随机选项生成
- 组合逻辑处理
- 效果应用机制

### 12. 文脉传承界面 (HeritageState)

[HeritageState](../Tracer/src/states/HeritageState.h)允许卡牌间传承印记。

#### 核心功能
- **传承选择**：选择源卡牌和目标卡牌
- **印记转移**：将源卡牌的印记传承给目标卡牌
- **传承限制**：不可传承的卡牌标识

#### 界面组成
- 源卡牌槽位
- 目标卡牌槽位
- "+"按钮
- 手牌选择区域

#### 技术实现
- 卡牌选择逻辑
- 印记转移算法
- 传承动画

### 13. 寻物人界面 (SeekerState)

[SeekerState](../Tracer/src/states/SeekerState.h)是卡牌发现机制。

#### 核心功能
- **卡牌翻面**：三张牌背，一张金羊毛
- **随机奖励**：其余两张带印记的随机卡牌
- **选择机制**：玩家选择获得的卡牌

#### 界面组成
- 牌背展示
- 翻面动画
- 选择反馈
- 获取动画

#### 技术实现
- 随机卡牌生成
- 翻面动画
- 选择处理

### 14. 淬炼界面 (TemperState)

[TemperState](../Tracer/src/states/TemperState.h)用于强化卡牌属性。

#### 核心功能
- **属性强化**：+1攻击力或+2生命值
- **卡牌选择**：从牌库中选择要强化的卡牌
- **强化限制**：每张卡牌的强化次数限制

#### 界面组成
- 强化槽位
- 选择按钮（攻击/生命）
- 牌库选择界面
- 确认按钮

#### 技术实现
- 强化逻辑
- 次数限制
- 动画效果

### 15. 墨魂界面 (InkGhostState)

[InkGhostState](../Tracer/src/states/InkGhostState.h)是卡牌生成机制。

#### 核心功能
- **卡牌生成**：基于选择生成新卡牌
- **手牌选择**：从手牌中选择参考卡牌
- **属性继承**：新卡牌继承部分属性

#### 界面组成
- 手牌展示
- 选择槽位
- 生成展示
- 确认按钮

#### 技术实现
- 卡牌生成算法
- 属性继承逻辑
- 动画系统

### 16. 问心试炼界面 (WenxinTrialState)

[WenxinTrialState](../Tracer/src/states/WenxinTrialState.h)提供多种试炼挑战。

#### 核心功能
- **试炼挑战**：六种不同类型的试炼
- **卡牌抽取**：抽取卡牌进行试炼
- **奖励机制**：成功后获得奖励卡牌

#### 界面组成
- 试炼卡牌展示
- 抽牌区域
- 试炼过程展示
- 奖励展示

#### 技术实现
- 试炼规则判定
- 抽牌动画
- 结果计算

### 17. 胜利界面 (VictoryState)

[VictoryState](../Tracer/src/states/VictoryState.h)在玩家获胜后显示。

#### 核心功能
- **胜利展示**：显示胜利信息
- **统计数据**：展示游戏统计数据
- **返回菜单**：返回主菜单
- **重新开始**：重新开始游戏

#### 界面组成
- 胜利标题
- 统计信息
- 操作按钮
- 动画效果

#### 技术实现
- 数据统计
- 动画系统
- 状态切换

## 界面交互设计原则

### 一致性原则
- 所有界面使用统一的视觉风格
- 相似功能采用相似的交互方式
- 按钮布局和样式保持一致

### 反馈原则
- 用户操作后提供即时反馈
- 状态变化通过视觉效果体现
- 错误操作给出明确提示

### 简洁性原则
- 界面布局清晰，信息层次分明
- 避免冗余元素，突出核心功能
- 操作流程简单直观

## 技术架构

### 状态管理模式
- 每个界面是一个独立状态类
- 通过状态切换实现界面转换
- 状态间数据通过全局存储传递

### 渲染系统
- 基于SDL2的2D渲染
- 纹理管理和字体渲染
- 动画系统实现流畅交互

### 输入处理
- 鼠标点击和悬停检测
- 按钮事件处理
- 键盘输入支持

## 扩展性设计

### 新界面添加
1. 继承[State](../Tracer/src/core/State.h)基类
2. 实现必要的虚函数接口
3. 在状态管理器中注册新状态
4. 添加状态切换逻辑

### 界面组件复用
- [Button](../Tracer/src/ui/Button.h)按钮组件
- [CardRenderer](../Tracer/src/ui/CardRenderer.h)卡牌渲染器
- 公共字体和样式定义

游戏界面系统通过精心设计的状态架构和丰富的交互功能，为玩家提供了沉浸式的游戏体验，每个界面都有其独特的价值和作用，共同构成了完整的游戏世界。