# 战斗系统

"溯洄遗梦"的战斗系统是游戏的核心玩法，采用回合制策略战斗机制，结合丰富的卡牌能力和印记系统。

## 战场布局

战斗在3行4列的网格战场上进行：

```
敌方区域（第1、2行）
[0][1][2][3]  ← 第1行（敌方前线）
[4][5][6][7]  ← 第2行（敌方后线）

我方区域（第3行）
[8][9][10][11] ← 第3行（我方战线）
```

## 回合制机制

### 回合流程

1. **玩家回合开始**
   - 抽牌阶段
   - 玩家操作阶段
   - 回合结束

2. **敌人回合开始**
   - 敌人前进
   - 敌人成长
   - 敌人攻击
   - 回合结束

### 回合状态

```cpp
enum class GamePhase {
    PlayerTurn,    // 玩家回合
    EnemyTurn,     // 敌人回合
    GameOver       // 游戏结束
};
```

## 卡牌操作

### 打牌机制

玩家可以将手牌放置到战场上的空位：
- 只能在第3行（我方战线）放置卡牌
- 每回合可以放置多张卡牌
- 放置的卡牌立即生效

### 攻击机制

卡牌在自己的回合可以攻击：
- **对位攻击**：攻击正对面的敌人
- **斜对位攻击**：攻击斜对面的敌人
- **全向攻击**：攻击对面所有敌人

### 特殊攻击类型

```cpp
enum class AttackType {
    Normal,         // 普通攻击（对位）
    Double,         // 双向攻击（斜对位）
    Triple,         // 三向攻击（对位+斜对位）
    Twice,          // 双重攻击（对位两次）
    DoubleTwice,    // 双向双重攻击（斜对位各攻击两次）
    TripleTwice,    // 三向双重攻击（对位+斜对位各攻击两次）
    AllDirection    // 全向打击（攻击对面全部卡牌）
};
```

## 印记系统

印记是卡牌的核心机制，为卡牌提供特殊能力：

### 移动类印记

- **横冲直撞**：可以在战场上移动并攻击路径上的敌人
- **蛮力冲撞**：可以推动其他卡牌
- **水袭**：潜水状态下免疫攻击，浮出时造成额外伤害

### 防御类印记

- **护主**：当同列前方卡牌死亡时，自动移动到前方位置
- **不死**：死亡后回到手牌
- **反伤**：受到攻击时对攻击者造成伤害

### 特殊机制印记

- **传承**：可以将印记传承给其他卡牌
- **献祭**：可以被献祭以获得资源
- **成长**：每回合增加攻击力或生命值
- **检索**：可以从牌库中检索特定卡牌

### 环境互动印记

- **风雅扇**：获得空袭能力
- **日晷**：影响墨尺平衡
- **断因剑**：可以选择攻击目标
- **吞墨毫**：可以消耗墨量增强攻击

## 墨尺平衡系统

墨尺是战斗中的核心平衡机制，显示双方的攻击平衡：

### 墨尺机制

- 范围：-5到+5
- 负值偏向玩家
- 正值偏向敌人
- 根据双方造成的伤害进行调整

### 墨尺影响

- 影响抽牌数量
- 影响资源获取
- 影响战斗结果

## 献祭系统

玩家可以献祭战场上的卡牌以获得资源：

### 献祭机制

1. 进入献祭模式
2. 选择可献祭的卡牌
3. 确认献祭
4. 获得墨量和其他资源

### 献祭效果

- 获得墨量（根据卡牌献祭消耗）
- 触发特殊印记效果
- 影响墨尺平衡

## 道具系统

战斗中可以使用道具增强能力：

### 道具槽位

- 最多携带3个道具
- 战斗中可以使用道具
- 道具效果影响战斗进程

### 道具类型

- 攻击增强类
- 防御增强类
- 资源获取类
- 特殊效果类

## Boss战系统

特殊的Boss敌人具有多阶段战斗机制：

### Boss阶段

1. **第一阶段**：基础能力
2. **第二阶段**：获得新能力或强化
3. **特殊机制**：每个Boss有独特的转阶段机制

### Boss类型

- 矿工Boss
- 渔夫Boss
- 猎人Boss
- 最终Boss

## 战斗资源

### 魂骨系统

- 击败敌人获得魂骨
- 魂骨可用于强化卡牌
- 不同敌人提供不同数量的魂骨

### 墨量系统

- 最大墨量为10
- 通过献祭获得墨量
- 消耗墨量使用特殊能力

## 战斗动画

### 动画系统

- 攻击动画
- 移动动画
- 特效动画
- 状态变化动画

### 动画时序

- 确保动画播放完成后再进行下一步
- 平滑的动画过渡
- 视觉反馈清晰

## 胜负判定

### 胜利条件

1. 击败所有敌方卡牌
2. 击败敌方Boss
3. 敌方生命值归零

### 失败条件

1. 我方生命值归零
2. 所有我方卡牌被击败且无法抽牌
3. 蜡烛系统中蜡烛燃尽

## 战斗策略

### 玩家策略

1. **卡牌组合**：合理搭配不同印记的卡牌
2. **资源管理**：平衡墨量和魂骨的使用
3. **时机把握**：选择合适的时机进行攻击或防御
4. **Boss应对**：针对不同Boss制定策略

### 敌人AI

1. **进攻性**：积极攻击玩家卡牌
2. **成长机制**：部分敌人具有成长能力
3. **特殊能力**：Boss具有独特技能
4. **阶段转换**：根据血量或条件转换阶段

## 战斗界面

### UI元素

- 战场网格显示
- 手牌区域
- 墨尺显示
- 生命值显示
- 道具槽位
- 状态信息

### 交互设计

- 点击放置卡牌
- 悬停查看信息
- 拖拽操作
- 按钮控制

战斗系统是"溯洄遗梦"最复杂的系统之一，融合了策略、资源管理和即时决策等多种元素，为玩家提供了深度的游戏体验。